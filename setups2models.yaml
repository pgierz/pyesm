esm-software:
        "esm-tools":
                git-repository: "gitlab.dkrz.de/esm-tools/esm-tools.git"
                available_versions:
                        - "r3"
        "esm-workshop":
                git-repository: "gitlab.dkrz.de/esm-tools/esm-workshop.git"
                available_versions:
                        - "Mai 2019"
        "esm-usermanual":
                git-repository: "gitlab.dkrz.de/esm-tools/esm-usermanual.git"
                available_versions:
                        - "r3"
        "git-workshop":
                git-repository: "gitlab.dkrz.de/esm-tools/git-workshop.git"
                available_versions:
                        - "Mai 2019"


defaults:                          
        compile_command: '"mkdir -p build; cd build; cmake ..;   make install -j `nproc --all`"'
        clean_command: '"rm -rf build CMakeCache.txt"'
               

components:
        "amip":
                git-repository: "gitlab.dkrz.de/ec-earth/amip-forcing.git"
                compile_command: "mkdir bin; cd src; make"
                clean_command: "rm -rf bin; cd src; make clean"

        "echam":
                install_bins: "${model_dir}/src/echam/bin/echam6"
                git-repository: "gitlab.dkrz.de/modular_esm/echam6.git"
                git-branch: "${echam.version}"
                available_versions:
                        - "6.304p1"
                        - "6.302p4"

        "fesom":
                install_bins: "${model_dir}/bin/fesom.x"
                choose_fesom.version: 
                        1.4:
                                git-repository: "gitlab.dkrz.de/modular_esm/fesom-1.4.git"
                        2.0:
                                git-repository: 
                                        - "gitlab.dkrz.de/FESOM/fesom2.git"
                                        - "github.com/FESOM/fesom2.git"
                                git-branch: "2.0.2"
                available_versions:
                        - "1.4"
                        - "2.0"

        "fesom_mesh_part":
                install_bins: "${model_dir}/bin/fesom.x.ini"
                choose_fesom.version: 
                        1.4:
                                git-repository: "gitlab.dkrz.de/modular_esm/fesom-1.4.git"
                        2.0:
                                git-repository: 
                                        - "gitlab.dkrz.de/FESOM/fesom2.git"
                                        - "github.com/FESOM/fesom2.git"
                                git-branch: "2.0.2"
                available_versions:
                        - "1.4"
                        - "2.0"
                compile_command: "cd mesh_part; mkdir build -p; cd build; cmake ..; make install -j `nproc --all`"
                clean_command: "rm -rf bin/fesom.x.ini mesh_part/build mesh_part/CMakeCache.txt"
        
        "icon":
                git-repository: "gitlab.dkrz.de/modular_esm/ICON-ATM.git"
                git-branch: "${icon.version}"
                configure_command: "./configure --with-fortran=gcc --with-openmp --with-grib_api"
                compile_command: "make -j `nproc --all"
                clean_command: "make distclean" 
                available_versions:
                        - "2.1.0"
                        - "2.3.0-nwp5"
                        - "2.4.0"
        
        "metos3d":
                git-repository: "https://github.com/metos3d/metos3d.git"
                git-subrepositories: 
                        - "https://github.com/metos3d/simpack.git"
                        - "https://github.com/metos3d/model.git"

        "metos3d-data":                  
                git-repository: "https://github.com/metos3d/data.git"
                compile_command: "cd data/data; gunzip -c TMM.tar.gz > TMM.tar; tar xf TMM.tar; rm -f TMM.tar"

        "nemo":
                available_versions:
                        - "3.6-foci"
                        - "3.6-ogcm"  
                git-repository: "gitlab.dkrz.de/modular_esm/nemo.git"
                git-branch: "foci1.11.1-2-g598572f"
                destination: "nemo-3.6"
                compile_command: "export NEMO_TOPLEVEL=${model_dir}; cd CONFIG; ./makenemo -n ${nemo.grid} -m ${computer.archfile} -j 24"
                clean_command: "cd CONFIG; ./makenemo -n ${nemo.grid} clean"
                install_bins: "${model_dir}/CONFIG/${nemo.grid}/BLD/bin/nemo.exe"
                choose_nemo.version:
                        "3.6-ogcm":
                                grid: "GYRE_XIOS"
                                requires:
                                        - xios-ogcm
                                        - oasis3-mct
                        "3.6-foci":
                                grid: "ORCA05_LIM2_KCM_AOW"
                                git-branch: "dirk_on_mistral"
        "oasis3-mct":
                install_libs: 
                        - "${model_dir}/build/lib/psmile/libpsmile.a"
                        - "${model_dir}/build/lib/psmile/mct/libmct.a"
                        - "${model_dir}/build/lib/psmile/mct/mpeu/libmpeu.a"
                        - "${model_dir}/build/lib/psmile/scrip/libscrip.a"
                compile_command: '"mkdir -p build; cd build; cmake ..;   make -j `nproc --all`"'
                git-repository: "gitlab.dkrz.de/modular_esm/oasis3-mct.git"
                destination: "oasis"
                available_versions:
                        - "foci"
                        - "ec-earth"
                        - "4.0"
                choose_oasis3-mct.version:
                        "ec-earth":
                                git-branch: "ec-earth-version"
                        "foci":
                                git-branch: "foci1.11.1-2-g598572f"
                # make sure all oasis versions are in the repo, with correct version branches          
        
        "oifs":
                install_bins: "${model_dir}/make/esm/oifs/bin/master.exe"
                compile_command: "cd make; ../fcm/bin/fcm make -v -j8 -f oifs.cfg"
                clean_command: "rm -rf make/esm"                
                git-repository: "gitlab.dkrz.de/modular_esm/oifs-40r1.git"        
                choose_oifs.version:
                        40r1:
                                git-branch: "esm-tools-workbench"
                        40r1-foci:
                                git-branch: "dirk_on_mistral"
                                destination: "40r1"
                        40r1-agcm:
                                compile_command: "export OIFS_COMP=agcm; cd make; ../fcm/bin/fcm make -v -j8 -f oifs-agcm.cfg"
                available_versions:
                        - "40r1"
                        - "40r1-foci"                
                        - "40r1-agcm"                
        
        "pism":
                compile_command: "mkdir -p build; cd build; cmake .. -DCMAKE_VERBOSE_MAKEFILE:BOOL=ON"
                choose_pism.version:
                        snowflake0.7:
                                git-repository: "swrepo1.awi.de/scmrepos/git/snowflake/snowflake.git"        
                                git-branch: "awi0.7-dev"
                        snowflake1.0:
                                git-repository: "swrepo1.awi.de/scmrepos/git/snowflake/snowflake.git"        
                                git-branch: "stable1.0-awi-dev"
                available_versions:
                        - "snowflake0.7"
                        - "snowflake1.0"  
        
        "recom":
                git-repository: "gitlab.dkrz.de/modular_esm/recom.git"
                git-branch: "modular"
                destination: "recom"
                available_versions:
                        - "2.0"
        
        "rnfmap":
                install_bins: "${model_dir}/bin/rnfmap.exe"
                compile_command: "rm -rf bin; mkdir bin; cd src; make"
                clean_command: "rm -rf bin; cd src; make clean"
                available_versions: 
                        - "ec-earth"
                        - "focioifs"  
                git-repository: "gitlab.dkrz.de/ec-earth/runoff-mapper.git"
                choose_rnfmap.version:
                        "ec-earth":
                                git-branch: "esm-tools"
                        "focioifs":
                                git-branch: "esm-tools-focioifs"
        
        "vilma":
                git-repository: "gitlab.dkrz.de/modular_esm/vilma.git vilma_1d"
                available_versions:
                        - "1d"
        
        "xios":
                available_versions:
                        - "2.0_r982"
                        - "ogcm"  
                git-repository: "gitlab.dkrz.de/modular_esm/xios.git"
                git-branch: "foci1.11.1-2-g598572f"
                compile_command: "./make_xios --arch ${computer.archfile} --netcdf_lib netcdf4_par --full --use_oasis oasis3_mct --job 24"
                clean_command: "rm -rf bin lib obj ppsrc"
                choose_xios.versddddion:
                        "ogcm":
                                compile_command: "./make_xios --arch ${computer.archfile} --netcdf_lib netcdf4_par --full --job 24"


couplings:
        "fesom-1.4+echam-6.3.04p1":
                components:
                        - "echam-6.304p1"
                        - "fesom-1.4"
                        - "oasis3-mct" 
                changes_in_shell:
                        - "sed -i '/FESOM_COUPLED/s/OFF/ON/g' fesom-1.4/CMakeLists.txt"
                        - "sed -i '/ECHAM6_COUPLED/s/OFF/ON/g' echam-6.3.04p1/CMakeLists.txt"

        "fesom-2.0+echam-6.3.04p1":
                components:
                        - "echam-6.304p1"
                        - "fesom-2.0"
                        - "oasis3-mct"
                changes_in_shell:
                        - "sed -i '/FESOM_COUPLED/s/OFF/ON/g' fesom-1.4/CMakeLists.txt"
                        - "sed -i '/ECHAM6_COUPLED/s/OFF/ON/g' echam-6.3.04p1/CMakeLists.txt"

        "fesom-2.0+oifs-40r1":
                components:
                        - "oifs-40r1"
                        - "fesom-2.0"
                        - "oasis3-mct-ec-earth" 

        "fesom-1.4+recom":
                components:
                        - "fesom-1.4"
                        - "recom"
                changes_in_shell:
                        - "sed -i '/FESOM_COUPLED/s/OFF/ON/g' fesom-1.4/CMakeLists.txt"
                        - "sed -i '/FESOM_RECOM/s/OFF/ON/g' fesom-1.4/CMakeLists.txt"
                        - "sed -i '/RECOM_LIBRARY/s/OFF/ON/g' fesom-1.4/CMakeLists.txt"  

        "fesom-2.0+recom":
                components:
                        - "fesom-2.0"
                        - "recom"
                changes_in_shell:
                        - "sed -i '/FESOM_COUPLED/s/OFF/ON/g' fesom-2.0/CMakeLists.txt"
                        - "sed -i '/FESOM_RECOM/s/OFF/ON/g' fesom-2.0/CMakeLists.txt"
                        - "sed -i '/RECOM_LIBRARY/s/OFF/ON/g' fesom-2.0/CMakeLists.txt"  
        
        "nemo-3.6+oifs-40r1":
                components:
                        - "oifs-40r1"
                        - "nemo-3.6"
                        - "oasis3-mct"
                        - "rnfmap"
                prepend_compile_command: "export FOCI_TOPLEVEL=${setup_dir}" 

        "pism-snowflake1.0+echam-6.304p1":
                components:
                        - "echam-6.304p1"
                        - "pism-snowflake1.0"
                        - "scope"

        "pism-snowflake1.0+fesom-1.4":
                components:
                        - "fesom-1.4"
                        - "pism-snowflake1.0"
                        - "scope"

        "oifs-40r1+amip":
                components:
                        - "oifs-40r1"
                        - "amip"
                        - "oasis3-mct"        
                changes_in_shell:
                        - "sed -i '/COUPLENEMOECE = /s/.FALSE./.TRUE./g' oifsamip/oifs-40r1/src/ifs/module/yommcc.F90"
                        - "sed -i '/COUPLEFESOM2 = /s/.TRUE./.FALSE./g' oifsamip/oifs-40r1/src/ifs/module/yommcc.F90"



setups:
        awicm-1.0:
                - "fesom-1.4+echam-6.3.04p1"

        awicm-CMIP6:
                - "fesom-1.4+echam-6.3.04p1"

        awicm-2.0:
                - "fesom-2.0+echam-6.3.04p1"

        awicm-3.0:
                - "fesom-2.0+oifs-40r1"

        awicm-1.0-recom:
                - "fesom-1.4+echam-6.3.04p1"
                - "fesom-1.4+recom"

        fesom-1.4-recom:
                - "fesom-1.4+recom"

        fesom-2.0-recom:
                - "fesom-2.0+recom"

        foci-oifs:          
                couplings: 
                        - "nemo+oifs"
                nemo:
                        version: 3.6-foci
                oifs:
                        version: 40r1-foci
                rnfmap: 
                        version: focioifs
                oasis3-mct:
                        version: foci       

        foci-oifs-vvl:          
                couplings: 
                        - "nemo+oifs"
                nemo:
                        version: 3.6-foci
                oifs:
                        version: 40r1-foci
                rnfmap: 
                        version: focioifs
                oasis3-mct:
                        version: foci       
                
        foci-oifs-vvl-o3:          
                couplings: 
                        - "nemo+oifs"
                nemo:
                        version: 3.6-foci
                oifs:
                        version: 40r1-foci
                rnfmap: 
                        version: focioifs
                oasis3-mct:
                        version: ec-earth

        foci-oifs-vvl-o3-awi3:          
                couplings: 
                        - "nemo+oifs"
                nemo:
                        version: 3.6-foci
                oifs:
                        version: 40r1
                rnfmap: 
                        version: focioifs
                oasis3-mct:
                        version: foci       
                
        foci-oifs-vvl-o4:          
                couplings: 
                        - "nemo+oifs"
                nemo:
                        version: 3.6-foci
                oifs:
                        version: 40r1-foci
                rnfmap: 
                        version: focioifs
                oasis3-mct:
                        version: "4.0"       
                
        oifsamip:
                - "oifs-40r1+amip"


